name: Build

on: push

jobs:
  linux-build:
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2.0.0
      - name: Install dependencies
        run: sudo apt-get install build-essential cmake pkg-config libftgl-dev qtbase5-dev qttools5-dev librtmidi-dev fluid-soundfont-gm libfluidsynth-dev
      - name: Build
        run: |
          mkdir build
          cd build
          cmake ..
          make
          find .
  macos-build:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.0.0
      - name: Install dependencies
        run: |
          brew update || brew update
          brew upgrade
          brew install cmake qt5 ftgl jack fluidsynth pkg-config
      - name: Build
        run: |
          mkdir build
          cd build
          cmake .. -DWITH_INTERNAL_FLUIDSYNTH=OFF -DCMAKE_PREFIX_PATH=$(brew --prefix qt)
          make
          find .
  windows-build:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.0.0
      - name: Install dependencies
        uses: lukka/run-vcpkg@v4
        with:
          vcpkgDirectory: ${{ github.workspace }}/vcpkg
          vcpkgArguments: fluidsynth qt5-base
          vcpkgGitUrl: 'https://github.com/microsoft/vcpkg.git'
          vcpkgGitCommitId: '56fffbe49dfb4dd8fae0940f272c5fd2b86be991'
          vcpkgTriplet: x64-windows
      - name:
        run: |
          PATH=$PATH:${GITHUB_WORKSPACE}/vcpkg/installed/x64-windows/lib/

          mkdir build
          cd build

          cmake .. -DCMAKE_PREFIX_PATH=../vcpkg/installed/x64-windows/lib/
          find .
          cmake --build
          find .
        shell: bash

